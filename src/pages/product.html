<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link href="../style/output.css" rel="stylesheet"> 
    <script src="../scripts/api.js"></script>
</head>
<body class=" text-[#000000]">
    <!-- Header -->
    <div class="w-full h-14 xl:h-16 bg-gradient-to-r from-[#FAEFE9] to-[#FFA280] flex items-center justify-between xl:px-8">
        <a href="./index.html"><img src="../assets/images/logo.png" class="pt-5"/></a>
        <div dir="rtl" class="gap-8 hidden xl:flex">
            <a class="font-medium" href="./">خانه</a>
            <a class="font-medium" href="./products.html">محصولات</a>
            <a class="font-medium" href="./about.html">درباره ما</a>
        </div>
        <div class="flex gap-5 items-center">
            <input dir="rtl" id="search" type="text" placeholder="جستجو" class="input invisible input-bordered input-sm w-32 max-w-xs"/>
            <img src="../assets/icons/Search.svg" class="cursor-pointer" id="search-icon"/>
            <div class="dropdown dropdown-bottom dropdown-end xl:hidden">
                <img tabindex="0" src="../assets/icons/menu 1.svg" class="pr-5 m-1 hover:cursor-pointer"/>
                <ul tabindex="0" class="dropdown-content -mt-[45px] menu bg-base-100 rounded-bl-xl z-[1] w-52 p-2 shadow">
                <li dir="rtl" class="font-medium text-lg"><a href="./">خانه</a></li>
                <li dir="rtl" class="font-medium text-lg"><a href="./about.html">درباره ما</a></li>
                <li dir="rtl" class="font-medium text-lg"><a href="./products.html">محصولات</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div id="search-pro" class="absolute z-30 right-[22em] top-14 w-0 h-0 flex flex-col">

    </div>

    <!-- Product -->
    <div class="flex flex-col xl:flex-row w-full xl:px-24 xl:justify-between xl:items-center p-5 from-[#ffe2d7] to-50% to-[#FAEFE9] bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))]" dir="rtl">
        <div class="xl:w-[45%] 2xl:w-[30%] flex flex-col justify-center items-center">
            <div class="w-full h-60 flex gap-5 justify-center items-center">  
                <button id="prev" class=" p-2">  
                    &#10094;
                </button>  
                <div class="w-full h-full overflow-hidden rounded-lg shadow-lg" id="swiperSlide">  
                    <img id="image" src="" alt="Image" class="w-full object-cover transition-opacity duration-500 h-full" />  
                </div>  
                <button id="next" class=" p-2"> 
                    &#10095;  
                </button>  
            </div>  
        
            <div id="imageCon" class="flex space-x-1 mt-6 gap-3 overflow-x-auto">      
            </div> 
        </div>
        <div class="flex flex-col py-7 px-3">
            <h2 id="name" class="text-2xl font-bold"></h2>
            <p id="desc" class=" pt-2 font-medium text-lg text-neutral"></p>
            
            <div class="flex justify-between items-center pt-10 border-b border-[#CDCDCD]">
                <p class="text-lg font-medium text-neutral">نوع محصول</p>
                <p id="category" class="text-lg font-medium"></p>
            </div>
            <div class="flex justify-between items-center pt-5 border-b border-[#CDCDCD]">
                <p class="text-lg font-medium text-neutral">وزن</p>
                <p id="weight" class="text-lg font-medium"></p>
            </div>
            <div class="flex justify-between items-center pt-5 border-b border-[#CDCDCD]">
                <p class="text-lg font-medium text-neutral">جنس</p>
                <p id="material" class="text-lg font-medium"></p>
            </div>
            <div class="flex justify-between items-center pt-5 border-b border-[#CDCDCD]">
                <p class="text-lg font-medium text-neutral">عیار</p>
                <p id="carat" class="text-lg font-medium"></p>
            </div>
            <div class="flex justify-between items-center pt-5 border-b border-[#CDCDCD]">
                <p class="text-lg font-medium text-neutral">رنگ</p>
                <p id="color" class="text-lg font-medium"></p>
            </div>

            <div class="pt-10 flex gap-6 justify-between items-center">
                <p class="text-xl font-medium">جهت خرید محصول با ما تماس بگیرید</p>
                <a class="btn bg-[#FFA280] hover:bg-[#FFA280] h-[48px] text-lg">خرید محصول</a>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <div class="flex flex-col w-full justify-center items-center gap-8 px-7 py-9 from-[#ffe2d7] to-50% to-[#FAEFE9] bg-[radial-gradient(circle_at_top_left,_var(--tw-gradient-stops))] ">
        <div class="flex flex-col w-full justify-center items-center">
            <h2 class="text-2xl font-bold">محصولات مشابه</h2>
            <div class="w-36 h-2 bg-[#FFA280] mt-3 rounded-3xl z-20"></div>
            <div class="w-[90%] h-1 bg-[#C5C5C5] rounded-3xl relative bottom-1"></div>
        </div>
        <div id="product-con" dir="rtl" class="grid grid-cols-2 xl:grid-cols-4 gap-8 w-full justify-items-center pt-4 ">
            
        </div>
    </div>

    <!-- Footer -->
    <div dir="rtl" class="flex flex-col w-full bg-[#FFE8DB] mt-10 gap-4 justify-center items-center xl:pt-10">
        <img class="-mt-14 max-w-[400px]" src="../assets/images/logo-bigger.png"/>
        <div class="w-full flex flex-col gap-4 xl:flex-row xl:justify-between  xl:px-[10%] xl:py-10">
            <div class="flex flex-col gap-4">
                <a href="./" class="font-medium text-xl px-16 -mt-10">خانه</a>
                <a href="./about.html" class="font-medium text-xl px-16">درباره ما </a>
                <a href="./products.html" class="font-medium text-xl px-16">محصولات</a>
            </div>
            <div class="flex justify-center gap-20 items-center p-7">
                <img class="w-8" src="../assets/icons/telegram 1.png"/>
                <img class="w-8" src="../assets/icons/instagram 1.png"/>
                <img class="w-8" src="../assets/icons/whatsapp.png"/>
            </div>
        </div>
        <div class="w-full h-[2px] bg-[#C3C3C3]"></div>
        <div class="flex justify-center pb-6">
            <p class="text-xl flex justify-center items-center">طراحی شده با <img class="w-8" src="../assets/icons/heart.png"/> در <a href="https://minddev.ir/" class="text-[#2d6ab9] mx-1"> MindDev </a></p>
        </div>
    </div>
</body>
<script type="module">  
    let currentSlideIndex = 0;  
    var images = [];  

    function changeSlide(direction) {  
        currentSlideIndex += direction;  
        if (currentSlideIndex < 0) {  
            currentSlideIndex = images.length - 1; // Loop to last image  
        } else if (currentSlideIndex >= images.length) {  
            currentSlideIndex = 0; // Loop to first image  
        }

        updateSwiper(images[currentSlideIndex]);  
    }  
    function updateSwiper(imageSrc) {
        const videoFormats = [".mp4",".webm",".ogv",".avi",".mov",".wmv",".flv",".mkv",".mpeg",".3gp",".rp"] 
        const swiperSlide = document.getElementById('swiperSlide');  
        if(videoFormats.some(s=> `${imageSrc}`.endsWith(s))){
            swiperSlide.innerHTML = `<video controls alt="Image" autoplay class="w-full h-full object-cover"><source type='video/mp4' src="${imageSrc}"></video>`;
        } else {
            swiperSlide.innerHTML = `<img src="${imageSrc}" alt="Image" class="w-full h-full object-cover"/>`;  
        }
        currentSlideIndex = images.indexOf(imageSrc);
    }


    import {apiUrl} from '../scripts/api.js'
    var productId = null

    document.getElementById('prev').addEventListener('click',() => changeSlide(-1))
    document.getElementById('next').addEventListener('click',() => changeSlide(1))
    
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    if(urlParams.has('id')){
        productId =  urlParams.get('id')
    }

    fetch(`${apiUrl()}/product/${productId}`) 
    .then(response => response.json())  
    .then(data => {  
        document.getElementById('name').innerHTML = data[0].name
        document.getElementById('desc').innerHTML = data[0].description
        document.getElementById('category').innerHTML = data[0].category
        document.getElementById('weight').innerHTML = data[0].weight
        document.getElementById('material').innerHTML = data[0].material
        document.getElementById('carat').innerHTML = data[0].carat
        document.getElementById('color').innerHTML = data[0].color
        document.getElementById('image').setAttribute('src',apiUrl()+data[0].image)
        const imageCon = document.getElementById('imageCon')
        images.push(apiUrl()+data[0].image)
        data[2].forEach(url => {
            const img = document.createElement('img')
            img.className = 'w-32 rounded-2xl max-h-36 min-h-28 h-32 bg-cover bg-center bg-no-repeat cursor-pointer transition-transform duration-300'
            img.setAttribute('src',apiUrl()+'/media/'+url)
            img.onclick = ()=> updateSwiper(apiUrl()+'/media/'+url)
            imageCon.append(img)
            images.push(apiUrl()+'/media/'+url)
        });
        data[1].forEach(url => {
            const source = document.createElement('source')
            source.setAttribute('src',apiUrl()+'/media/'+url)
            source.setAttribute('type', 'video/mp4');
            const vid = document.createElement('video')
            vid.className = 'w-32 rounded-2xl max-h-36 min-h-28 h-40 bg-cover bg-center bg-no-repeat cursor-pointer transition-transform duration-300'
            vid.appendChild(source)
            vid.currentTime=5
            vid.onclick = () => updateSwiper(apiUrl()+'/media/'+url)
            imageCon.append(vid)
            images.push(apiUrl()+'/media/'+url)
        })
    })

    fetch(`${apiUrl()}/products/`)  
            .then(response => response.json())  
            .then(data => {  
                const productCon = document.getElementById('product-con')
                data[0].forEach(item => {  
                    const div = document.createElement('div');
                    div.className =  'flex flex-col max-w-[160px]'
                    div.innerHTML = `  
                        <img src="${apiUrl()}${item.image}" class="max-w-[140px] xl:max-w-[300px]"/>
                        <a href="./product.html?id=${item.id}" class="text-[#FFA280] text-2xl font-bold pt-3">${item.name}</a>
                        <p class="pt-1 text-lg">${item.description}</p>
                    `;  
                    productCon.appendChild(div); 
                }); 
            })  
            .catch(error => console.error('Error fetching data:', error)); 
</script>
</html>